<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <style>
      body {
        font-family: 'Roboto', sans-serif;
      }
    </style>

    <script type="text/javascript" src="http://cdn.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
    <script type="text/javascript" src="http://cdn.robotwebtools.org/roslibjs/current/roslib.min.js"></script>
    <script>
      $.get('/get_websocket_url', function(data, status) {
        var ws_url = data;
        var ros = new ROSLIB.Ros({
          url: ws_url
        });
        
        ros.on('connection', function() {
          console.log('Connected to websocket server.');
        });
        
        ros.on('error', function(error) {
          console.log('Error connecting to websocket server: ', error);
        });
        
        ros.on('close', function() {
          console.log('Connection to websocket server closed.');
        });

        var tts_topic = new ROSLIB.Topic({
          ros: ros,
          name: 'rws_simple_action_interface/text_to_speech',
          messageType: 'std_msgs/String'
        });

        function SaySomethingController(ros, tts_topic) {
          this.ros = ros;
          this.tts_topic = tts_topic;
        }
        SaySomethingController.prototype.speak = function(text) {
          var msg = new ROSLIB.Message({ data: text });
          this.tts_topic.publish(msg);
        }

        var nod_topic = new ROSLIB.Topic({
          ros: ros,
          name: 'rws_simple_action_interface/nod',
          messageType: 'std_msgs/Int8'
        });

        function NodController(ros, nod_topic) {
          this.ros = ros;
          this.nod_topic = nod_topic;
        }
        NodController.prototype.nod = function(num) {
          num = Number(num);
          var msg = new ROSLIB.Message({ data: num });
          this.nod_topic.publish(msg);
        }

        var shake_topic = new ROSLIB.Topic({
          ros: ros,
          name: 'rws_simple_action_interface/shake',
          messageType: 'std_msgs/Int8'
        });

        function ShakeController(ros, shake_topic) {
          this.ros = ros;
          this.shake_topic = shake_topic;
        }
        ShakeController.prototype.shake = function(num) {
          num = Number(num);
          var msg = new ROSLIB.Message({ data: num });
          this.shake_topic.publish(msg);
        }

        var laser_ON_topic = new ROSLIB.Topic({
          ros: ros,
          name: 'rws_simple_action_interface/laser_ON',
          messageType: 'std_msgs/Empty'
        });
        function LaserOnController(ros, laser_ON_topic) {
          this.ros = ros;
          this.laser_ON_topic = laser_ON_topic;
        }
        LaserOnController.prototype.laser_ON = function(){
          var msg = new ROSLIB.Message();
          this.laser_ON_topic.publish(msg);
        }

        var laser_OFF_topic = new ROSLIB.Topic({
          ros: ros,
          name: 'rws_simple_action_interface/laser_OFF',
          messageType: 'std_msgs/Empty'
        });
        function LaserOffController(ros, laser_OFF_topic) {
          this.ros = ros;
          this.laser_OFF_topic = laser_OFF_topic;
        }
        LaserOffController.prototype.laser_OFF = function(){
          var msg = new ROSLIB.Message();
          this.laser_OFF_topic.publish(msg);
        }

        var command_topic = new ROSLIB.Topic({
          ros:ros,
          name: 'rws_simple_action_interface/command',
          messageType: 'std_msgs/String'
        });
        function CommandController(ros, command_topic){
          this.ros = ros;
          this.command_topic = command_topic;
        }
        CommandController.prototype.filter = function(text){
          var msg = new ROSLIB.Message({ data: text});
          this.command_topic.publish(msg);
        }
        

        $(document).ready(function() {
          var speaker = new SaySomethingController(ros, tts_topic);
          var head = new NodController(ros, nod_topic);
          var head2 = new ShakeController(ros, shake_topic);
          var laser = new LaserOnController(ros, laser_ON_topic);
          var laser2 - new LaserOffController(ros, laser_OFF_topic);
          var commander = new CommandController(ros, command_topic);
        
          $('#talk_button').click(function() {
            var text = $('#text_input').val();
            speaker.speak(text);
          });
          $('#nod_button').click(function(){
            var num = $('#num_input').val();
            head.nod(num);
          });
          $('#shake_button').click(function(){
            var num = $("#num2_input").val();
            head2.shake(num);
          });
          $('#laser_ON_button').click(function(){
            laser.laser_ON();
          })
          $('#laser_OFF_button').click(function(){
            laser.laser_OFF();
          })
          $('command_button').click(function(){
            var initialCommand = $('#text2_input').val();
            var finalCommand = commander.filter(initialCommand);
            if (finalCommand == "nod"){
              head.nod(2);
            } else if (finalCommand == "shake"){
              head2.shake(2);
            }
          });
        });
      });
      
    </script>
      
    <style>
    </style>
  </head>
  
  <body>
    <h1 class="page-header">Say something</h1>
    <h6>Enter text for the PR2 to speak</h6>
    <form class="form" id="talk_form" role="form">
      <div class="input-group">
        <input type="text" id="text_input" class="form-control" >
        <span class="input-group-btn">
          <button class="btn btn-default" id="talk_button" type="button">Go!</button>
        </span>
      </div>
    </form>
    <h1 class ="page-header">Nod</h1>
    <h6>Enter the number of times the PR2 will nod</h6>
    <form class="form" id="talk_form" role="form">
      <div class="input-group">
        <input type="number" id="num_input" class="form-control">
        <span class="input-group-btn">
          <button class="btn btn-default" id="nod_button" type="button">Go!</button>
        </span>
      </div>
    </form>
    <h1 class ="page-header">Shake Head</h1>
    <h6>Enter the number of times the PR2 will shake its head</h6>
    <form class="form" id="talk_form" role="form">
      <div class="input-group">
        <input type="number" id="num2_input" class="form-control">
        <span class="input-group-btn">
          <button class="btn btn-default" id="shake_button" type="button">Go!</button>
        </span>
      </div>
    </form>
    <h1 class ="page-header">Laser</h1>
    <form class="form" id="talk_form" role="form">
      <div class="input-group">
        <span class="input-group-btn">
          <button class="btn btn-default" id="laser_ON_button" type="button">Laser ON</button>
          <button class="btn btn-default" id="laser_OFF_button" type="button">Laser OFF</button>
        </span>
      </div>
    </form>
  </body>
</html>
